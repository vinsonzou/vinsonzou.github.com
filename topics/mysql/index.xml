<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Mysql on ops</title>
    <link>https://ops.m114.org/topics/mysql/index.xml</link>
    <description>Recent content in Mysql on ops</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <copyright>&amp;copy; 2014-2018. All rights reserved.</copyright>
    <atom:link href="https://ops.m114.org/topics/mysql/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>不重启解决Too Many Connections</title>
      <link>https://ops.m114.org/post/solve-too-many-connections/</link>
      <pubDate>Sat, 07 Jan 2017 19:57:32 +0800</pubDate>
      
      <guid>https://ops.m114.org/post/solve-too-many-connections/</guid>
      <description>&lt;p&gt;当发生Too many connections时，即使是DBA也无法登录到数据库，一般的做法是修改配置文件的max_connections参数，然后重启数据库，这样业务就有几秒钟的中断，对于线上不能中断的数据库就只能采用另外一种极客的方法了，用gdb直接修改mysqld内存中max_connections的值，具体做法如下：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;gdb -p $(cat /data/mysql/mysql-server.pid) -ex &amp;quot;set max_connections=3000&amp;quot; -batch
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;改进方法如下&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;通常有两个参数控制控制最大连接数：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;max_connections：该实例允许最大的连接数
max_user_connections：该实例允许每个用户的最大连接数
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;每个人要根据自己业务量，设置合适的值，不要盲目设置过大，但也不可设置过小，因为MySQL在连接数上升的情况下性能下降非常厉害，如果需要大量连接，这时可以引入thread_pool，所以我们需要保持一个原则：系统创建的用户（给应用使用用户）数 * max_user_connections &amp;lt; max_connections。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>MySQL Unable to lock ibdata1 error 11 fix</title>
      <link>https://ops.m114.org/post/MySQL-Unable-to-lock-ibdata1-error-11-fix/</link>
      <pubDate>Wed, 03 Aug 2016 10:52:24 +0800</pubDate>
      
      <guid>https://ops.m114.org/post/MySQL-Unable-to-lock-ibdata1-error-11-fix/</guid>
      <description>

&lt;p&gt;A bad shutdown can cause such erros on MySQL.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;InnoDB: Unable to lock ./ibdata1, error: 11
InnoDB: Check that you do not already have another mysqld process
InnoDB: using the same InnoDB data or log files.
InnoDB: Error in opening ./ibdata1
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;for-solution&#34;&gt;For solution&lt;/h2&gt;

&lt;pre&gt;&lt;code&gt;mv ibdata1 ibdata1.bak
cp -a ibdata1.bak ibdata1
service mysqld restart
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
  </channel>
</rss>