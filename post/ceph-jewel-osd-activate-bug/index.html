<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.88.1" />

  <title>ceph集群jewel版本部署osd激活权限报错 &middot; ops</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://ops.m114.org/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://ops.m114.org/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://ops.m114.org/css/blackburn.css">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet" type="text/css">

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css">
  <script async src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://ops.m114.org/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://ops.m114.org/">Ops</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://ops.m114.org/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://ops.m114.org/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://ops.m114.org/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://ops.m114.org/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://ops.m114.org/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/vinsonzou" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2014-2021. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>ceph集群jewel版本部署osd激活权限报错</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>2016/07/29, 00:29</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="https://ops.m114.org/topics/Ceph">Ceph</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://ops.m114.org/tags/ceph">ceph</a>
    
  </div>
  
  

</div>

  <p><strong>环境</strong></p>
<p>ceph version 10.2.2 (45107e21c568dd033c2f0a3107dec8f0b0e58374)<!-- raw HTML omitted -->
ceph-deploy 1.5.34</p>
<p>ceph集群jewel版本部署过程中执行osd激活操作如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ceph-deploy osd activate ceph13:/dev/sdb1:/dev/sda2
</code></pre></div><p>报错内容如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>2016-07-29 00:05:19,106<span style="color:#f92672">][</span>ceph_deploy.conf<span style="color:#f92672">][</span>DEBUG <span style="color:#f92672">]</span> found configuration file at: /root/.cephdeploy.conf
<span style="color:#f92672">[</span>2016-07-29 00:05:19,107<span style="color:#f92672">][</span>ceph_deploy.cli<span style="color:#f92672">][</span>INFO  <span style="color:#f92672">]</span> Invoked <span style="color:#f92672">(</span>1.5.34<span style="color:#f92672">)</span>: /bin/ceph-deploy osd activate ceph13:/dev/sdb1:/dev/sda2
<span style="color:#f92672">[</span>2016-07-29 00:05:19,107<span style="color:#f92672">][</span>ceph_deploy.cli<span style="color:#f92672">][</span>INFO  <span style="color:#f92672">]</span> ceph-deploy options:
<span style="color:#f92672">[</span>2016-07-29 00:05:19,108<span style="color:#f92672">][</span>ceph_deploy.cli<span style="color:#f92672">][</span>INFO  <span style="color:#f92672">]</span>  username                      : None
<span style="color:#f92672">[</span>2016-07-29 00:05:19,108<span style="color:#f92672">][</span>ceph_deploy.cli<span style="color:#f92672">][</span>INFO  <span style="color:#f92672">]</span>  verbose                       : False
<span style="color:#f92672">[</span>2016-07-29 00:05:19,108<span style="color:#f92672">][</span>ceph_deploy.cli<span style="color:#f92672">][</span>INFO  <span style="color:#f92672">]</span>  overwrite_conf                : False
<span style="color:#f92672">[</span>2016-07-29 00:05:19,108<span style="color:#f92672">][</span>ceph_deploy.cli<span style="color:#f92672">][</span>INFO  <span style="color:#f92672">]</span>  subcommand                    : activate
<span style="color:#f92672">[</span>2016-07-29 00:05:19,108<span style="color:#f92672">][</span>ceph_deploy.cli<span style="color:#f92672">][</span>INFO  <span style="color:#f92672">]</span>  quiet                         : False
<span style="color:#f92672">[</span>2016-07-29 00:05:19,108<span style="color:#f92672">][</span>ceph_deploy.cli<span style="color:#f92672">][</span>INFO  <span style="color:#f92672">]</span>  cd_conf                       : &lt;ceph_deploy.conf.cephdeploy.Conf instance at 0x26dcb90&gt;
<span style="color:#f92672">[</span>2016-07-29 00:05:19,109<span style="color:#f92672">][</span>ceph_deploy.cli<span style="color:#f92672">][</span>INFO  <span style="color:#f92672">]</span>  cluster                       : ceph
<span style="color:#f92672">[</span>2016-07-29 00:05:19,109<span style="color:#f92672">][</span>ceph_deploy.cli<span style="color:#f92672">][</span>INFO  <span style="color:#f92672">]</span>  func                          : &lt;<span style="color:#66d9ef">function</span> osd at 0x26d0320&gt;
<span style="color:#f92672">[</span>2016-07-29 00:05:19,109<span style="color:#f92672">][</span>ceph_deploy.cli<span style="color:#f92672">][</span>INFO  <span style="color:#f92672">]</span>  ceph_conf                     : None
<span style="color:#f92672">[</span>2016-07-29 00:05:19,109<span style="color:#f92672">][</span>ceph_deploy.cli<span style="color:#f92672">][</span>INFO  <span style="color:#f92672">]</span>  default_release               : False
<span style="color:#f92672">[</span>2016-07-29 00:05:19,109<span style="color:#f92672">][</span>ceph_deploy.cli<span style="color:#f92672">][</span>INFO  <span style="color:#f92672">]</span>  disk                          : <span style="color:#f92672">[(</span><span style="color:#e6db74">&#39;ceph13&#39;</span>, <span style="color:#e6db74">&#39;/dev/sdb1&#39;</span>, <span style="color:#e6db74">&#39;/dev/sda2&#39;</span><span style="color:#f92672">)]</span>
<span style="color:#f92672">[</span>2016-07-29 00:05:19,110<span style="color:#f92672">][</span>ceph_deploy.osd<span style="color:#f92672">][</span>DEBUG <span style="color:#f92672">]</span> Activating cluster ceph disks ceph13:/dev/sdb1:/dev/sda2
<span style="color:#f92672">[</span>2016-07-29 00:05:19,217<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>DEBUG <span style="color:#f92672">]</span> connected to host: ceph13
<span style="color:#f92672">[</span>2016-07-29 00:05:19,218<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>DEBUG <span style="color:#f92672">]</span> detect platform information from remote host
<span style="color:#f92672">[</span>2016-07-29 00:05:19,258<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>DEBUG <span style="color:#f92672">]</span> detect machine type
<span style="color:#f92672">[</span>2016-07-29 00:05:19,264<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>DEBUG <span style="color:#f92672">]</span> find the location of an executable
<span style="color:#f92672">[</span>2016-07-29 00:05:19,266<span style="color:#f92672">][</span>ceph_deploy.osd<span style="color:#f92672">][</span>INFO  <span style="color:#f92672">]</span> Distro info: CentOS Linux 7.2.1511 Core
<span style="color:#f92672">[</span>2016-07-29 00:05:19,266<span style="color:#f92672">][</span>ceph_deploy.osd<span style="color:#f92672">][</span>DEBUG <span style="color:#f92672">]</span> activating host ceph13 disk /dev/sdb1
<span style="color:#f92672">[</span>2016-07-29 00:05:19,266<span style="color:#f92672">][</span>ceph_deploy.osd<span style="color:#f92672">][</span>DEBUG <span style="color:#f92672">]</span> will use init type: systemd
<span style="color:#f92672">[</span>2016-07-29 00:05:19,266<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>DEBUG <span style="color:#f92672">]</span> find the location of an executable
<span style="color:#f92672">[</span>2016-07-29 00:05:19,270<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>INFO  <span style="color:#f92672">]</span> Running command: /usr/sbin/ceph-disk -v activate --mark-init systemd --mount /dev/sdb1
<span style="color:#f92672">[</span>2016-07-29 00:05:19,598<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span> main_activate: path <span style="color:#f92672">=</span> /dev/sdb1
<span style="color:#f92672">[</span>2016-07-29 00:05:19,598<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span> get_dm_uuid: get_dm_uuid /dev/sdb1 uuid path is /sys/dev/block/8:17/dm/uuid
<span style="color:#f92672">[</span>2016-07-29 00:05:19,598<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span> command: Running command: /sbin/blkid -o udev -p /dev/sdb1
<span style="color:#f92672">[</span>2016-07-29 00:05:19,630<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span> command: Running command: /sbin/blkid -p -s TYPE -o value -- /dev/sdb1
<span style="color:#f92672">[</span>2016-07-29 00:05:19,638<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span> command: Running command: /usr/bin/ceph-conf --cluster<span style="color:#f92672">=</span>ceph --name<span style="color:#f92672">=</span>osd. --lookup osd_mount_options_xfs
<span style="color:#f92672">[</span>2016-07-29 00:05:19,803<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span> command: Running command: /usr/bin/ceph-conf --cluster<span style="color:#f92672">=</span>ceph --name<span style="color:#f92672">=</span>osd. --lookup osd_fs_mount_options_xfs
<span style="color:#f92672">[</span>2016-07-29 00:05:19,967<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span> mount: Mounting /dev/sdb1 on /var/lib/ceph/tmp/mnt.K5WBsO with options noatime,inode64
<span style="color:#f92672">[</span>2016-07-29 00:05:19,967<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span> command_check_call: Running command: /usr/bin/mount -t xfs -o noatime,inode64 -- /dev/sdb1 /var/lib/ceph/tmp/mnt.K5WBsO
<span style="color:#f92672">[</span>2016-07-29 00:05:19,983<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span> command: Running command: /sbin/restorecon /var/lib/ceph/tmp/mnt.K5WBsO
<span style="color:#f92672">[</span>2016-07-29 00:05:19,991<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span> activate: Cluster uuid is f2694afb-b5fc-4225-982a-342c4a1ca389
<span style="color:#f92672">[</span>2016-07-29 00:05:19,991<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span> command: Running command: /usr/bin/ceph-osd --cluster<span style="color:#f92672">=</span>ceph --show-config-value<span style="color:#f92672">=</span>fsid
<span style="color:#f92672">[</span>2016-07-29 00:05:20,156<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span> activate: Cluster name is ceph
<span style="color:#f92672">[</span>2016-07-29 00:05:20,156<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span> activate: OSD uuid is 684effdc-67ae-4f54-a9b8-a113f4a8f0cc
<span style="color:#f92672">[</span>2016-07-29 00:05:20,156<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span> activate: OSD id is <span style="color:#ae81ff">0</span>
<span style="color:#f92672">[</span>2016-07-29 00:05:20,156<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span> activate: Initializing OSD...
<span style="color:#f92672">[</span>2016-07-29 00:05:20,157<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span> command_check_call: Running command: /usr/bin/ceph --cluster ceph --name client.bootstrap-osd --keyring /var/lib/ceph/bootstrap-osd/ceph.keyring mon getmap -o /var/lib/ceph/tmp/mnt.K5WBsO/activate.monmap
<span style="color:#f92672">[</span>2016-07-29 00:05:20,572<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span> got monmap epoch <span style="color:#ae81ff">1</span>
<span style="color:#f92672">[</span>2016-07-29 00:05:20,572<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span> command: Running command: /usr/bin/timeout <span style="color:#ae81ff">300</span> ceph-osd --cluster ceph --mkfs --mkkey -i <span style="color:#ae81ff">0</span> --monmap /var/lib/ceph/tmp/mnt.K5WBsO/activate.monmap --osd-data /var/lib/ceph/tmp/mnt.K5WBsO --osd-journal /var/lib/ceph/tmp/mnt.K5WBsO/journal --osd-uuid 684effdc-67ae-4f54-a9b8-a113f4a8f0cc --keyring /var/lib/ceph/tmp/mnt.K5WBsO/keyring --setuser ceph --setgroup ceph
<span style="color:#f92672">[</span>2016-07-29 00:05:20,686<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span> mount_activate: Failed to activate
<span style="color:#f92672">[</span>2016-07-29 00:05:20,686<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span> unmount: Unmounting /var/lib/ceph/tmp/mnt.K5WBsO
<span style="color:#f92672">[</span>2016-07-29 00:05:20,687<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span> command_check_call: Running command: /bin/umount -- /var/lib/ceph/tmp/mnt.K5WBsO
<span style="color:#f92672">[</span>2016-07-29 00:05:21,052<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span> Traceback <span style="color:#f92672">(</span>most recent call last<span style="color:#f92672">)</span>:
<span style="color:#f92672">[</span>2016-07-29 00:05:21,052<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span>   File <span style="color:#e6db74">&#34;/usr/sbin/ceph-disk&#34;</span>, line 9, in &lt;module&gt;
<span style="color:#f92672">[</span>2016-07-29 00:05:21,052<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span>     load_entry_point<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;ceph-disk==1.0.0&#39;</span>, <span style="color:#e6db74">&#39;console_scripts&#39;</span>, <span style="color:#e6db74">&#39;ceph-disk&#39;</span><span style="color:#f92672">)()</span>
<span style="color:#f92672">[</span>2016-07-29 00:05:21,052<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span>   File <span style="color:#e6db74">&#34;/usr/lib/python2.7/site-packages/ceph_disk/main.py&#34;</span>, line 4994, in run
<span style="color:#f92672">[</span>2016-07-29 00:05:21,053<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span>     main<span style="color:#f92672">(</span>sys.argv<span style="color:#f92672">[</span>1:<span style="color:#f92672">])</span>
<span style="color:#f92672">[</span>2016-07-29 00:05:21,053<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span>   File <span style="color:#e6db74">&#34;/usr/lib/python2.7/site-packages/ceph_disk/main.py&#34;</span>, line 4945, in main
<span style="color:#f92672">[</span>2016-07-29 00:05:21,053<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span>     args.func<span style="color:#f92672">(</span>args<span style="color:#f92672">)</span>
<span style="color:#f92672">[</span>2016-07-29 00:05:21,053<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span>   File <span style="color:#e6db74">&#34;/usr/lib/python2.7/site-packages/ceph_disk/main.py&#34;</span>, line 3299, in main_activate
<span style="color:#f92672">[</span>2016-07-29 00:05:21,053<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span>     reactivate<span style="color:#f92672">=</span>args.reactivate,
<span style="color:#f92672">[</span>2016-07-29 00:05:21,054<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span>   File <span style="color:#e6db74">&#34;/usr/lib/python2.7/site-packages/ceph_disk/main.py&#34;</span>, line 3056, in mount_activate
<span style="color:#f92672">[</span>2016-07-29 00:05:21,054<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span>     <span style="color:#f92672">(</span>osd_id, cluster<span style="color:#f92672">)</span> <span style="color:#f92672">=</span> activate<span style="color:#f92672">(</span>path, activate_key_template, init<span style="color:#f92672">)</span>
<span style="color:#f92672">[</span>2016-07-29 00:05:21,054<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span>   File <span style="color:#e6db74">&#34;/usr/lib/python2.7/site-packages/ceph_disk/main.py&#34;</span>, line 3232, in activate
<span style="color:#f92672">[</span>2016-07-29 00:05:21,054<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span>     keyring<span style="color:#f92672">=</span>keyring,
<span style="color:#f92672">[</span>2016-07-29 00:05:21,054<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span>   File <span style="color:#e6db74">&#34;/usr/lib/python2.7/site-packages/ceph_disk/main.py&#34;</span>, line 2725, in mkfs
<span style="color:#f92672">[</span>2016-07-29 00:05:21,055<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span>     <span style="color:#e6db74">&#39;--setgroup&#39;</span>, get_ceph_group<span style="color:#f92672">()</span>,
<span style="color:#f92672">[</span>2016-07-29 00:05:21,055<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span>   File <span style="color:#e6db74">&#34;/usr/lib/python2.7/site-packages/ceph_disk/main.py&#34;</span>, line 2672, in ceph_osd_mkfs
<span style="color:#f92672">[</span>2016-07-29 00:05:21,055<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span>     raise Error<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;%s failed : %s&#39;</span> % <span style="color:#f92672">(</span>str<span style="color:#f92672">(</span>arguments<span style="color:#f92672">)</span>, error<span style="color:#f92672">))</span>
<span style="color:#f92672">[</span>2016-07-29 00:05:21,055<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span> ceph_disk.main.Error: Error: <span style="color:#f92672">[</span><span style="color:#e6db74">&#39;ceph-osd&#39;</span>, <span style="color:#e6db74">&#39;--cluster&#39;</span>, <span style="color:#e6db74">&#39;ceph&#39;</span>, <span style="color:#e6db74">&#39;--mkfs&#39;</span>, <span style="color:#e6db74">&#39;--mkkey&#39;</span>, <span style="color:#e6db74">&#39;-i&#39;</span>, <span style="color:#e6db74">&#39;0&#39;</span>, <span style="color:#e6db74">&#39;--monmap&#39;</span>, <span style="color:#e6db74">&#39;/var/lib/ceph/tmp/mnt.K5WBsO/activate.monmap&#39;</span>, <span style="color:#e6db74">&#39;--osd-data&#39;</span>, <span style="color:#e6db74">&#39;/var/lib/ceph/tmp/mnt.K5WBsO&#39;</span>, <span style="color:#e6db74">&#39;--osd-journal&#39;</span>, <span style="color:#e6db74">&#39;/var/lib/ceph/tmp/mnt.K5WBsO/journal&#39;</span>, <span style="color:#e6db74">&#39;--osd-uuid&#39;</span>, <span style="color:#e6db74">&#39;684effdc-67ae-4f54-a9b8-a113f4a8f0cc&#39;</span>, <span style="color:#e6db74">&#39;--keyring&#39;</span>, <span style="color:#e6db74">&#39;/var/lib/ceph/tmp/mnt.K5WBsO/keyring&#39;</span>, <span style="color:#e6db74">&#39;--setuser&#39;</span>, <span style="color:#e6db74">&#39;ceph&#39;</span>, <span style="color:#e6db74">&#39;--setgroup&#39;</span>, <span style="color:#e6db74">&#39;ceph&#39;</span><span style="color:#f92672">]</span> failed : 2016-07-29 00:05:20.672440 7f46517dd800 -1 filestore<span style="color:#f92672">(</span>/var/lib/ceph/tmp/mnt.K5WBsO<span style="color:#f92672">)</span> mkjournal error creating journal on /var/lib/ceph/tmp/mnt.K5WBsO/journal: <span style="color:#f92672">(</span>13<span style="color:#f92672">)</span> Permission denied
<span style="color:#f92672">[</span>2016-07-29 00:05:21,056<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span> 2016-07-29 00:05:20.672462 7f46517dd800 -1 OSD::mkfs: ObjectStore::mkfs failed with error -13
<span style="color:#f92672">[</span>2016-07-29 00:05:21,056<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span> 2016-07-29 00:05:20.672526 7f46517dd800 -1  ** ERROR: error creating empty object store in /var/lib/ceph/tmp/mnt.K5WBsO: <span style="color:#f92672">(</span>13<span style="color:#f92672">)</span> Permission denied
<span style="color:#f92672">[</span>2016-07-29 00:05:21,056<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>WARNING<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>2016-07-29 00:05:21,057<span style="color:#f92672">][</span>ceph13<span style="color:#f92672">][</span>ERROR <span style="color:#f92672">]</span> RuntimeError: command returned non-zero exit status: <span style="color:#ae81ff">1</span>
<span style="color:#f92672">[</span>2016-07-29 00:05:21,057<span style="color:#f92672">][</span>ceph_deploy<span style="color:#f92672">][</span>ERROR <span style="color:#f92672">]</span> RuntimeError: Failed to execute command: /usr/sbin/ceph-disk -v activate --mark-init systemd --mount /dev/sdb1
</code></pre></div><p><strong>解决办法:</strong></p>
<p>将ceph集群需要使用的所有磁盘权限，所属用户、用户组改给ceph</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">chown ceph:ceph /dev/sdb1
</code></pre></div><p><strong>问题延伸:</strong></p>
<p>此问题本次修复后，系统重启磁盘权限会被修改回，导致osd服务无法正常启动，这个权限问题很坑，每次系统启动自动修改磁盘权限。</p>
<p>查找ceph资料，发现这其实是一个bug，社区暂未解决。</p>
<p><a href="http://tracker.ceph.com/issues/13833">http://tracker.ceph.com/issues/13833</a></p>

  
  <h4><i class="fas fa-share-alt" aria-hidden="true"></i>&nbsp;Share!</h4>
<ul class="share-buttons">
	<li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fops.m114.org%2fpost%2fceph-jewel-osd-activate-bug%2f" target="_blank" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span class="sr-only">Share on Facebook</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://twitter.com/intent/tweet?source=https%3a%2f%2fops.m114.org%2fpost%2fceph-jewel-osd-activate-bug%2f" target="_blank" title="Tweet"><i class="fab fa-twitter" aria-hidden="true"></i><span class="sr-only">Tweet</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://plus.google.com/share?url=https%3a%2f%2fops.m114.org%2fpost%2fceph-jewel-osd-activate-bug%2f" target="_blank" title="Share on Google+"><i class="fab fa-google-plus" aria-hidden="true"></i><span class="sr-only">Share on Google+</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.tumblr.com/share?v=3&u=https%3a%2f%2fops.m114.org%2fpost%2fceph-jewel-osd-activate-bug%2f" target="_blank" title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden="true"></i><span class="sr-only">Post to Tumblr</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2fops.m114.org%2fpost%2fceph-jewel-osd-activate-bug%2f" target="_blank" title="Pin it"><i class="fab fa-pinterest-p" aria-hidden="true"></i><span class="sr-only">Pin it</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.reddit.com/submit?url=https%3a%2f%2fops.m114.org%2fpost%2fceph-jewel-osd-activate-bug%2f" target="_blank" title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden="true"></i><span class="sr-only">Submit to Reddit</span></a>
	</li>
</ul>


<style>
	ul.share-buttons{
	  list-style: none;
	  padding: 0;
	}

	ul.share-buttons li{
	  display: inline;
	}

	ul.share-buttons .sr-only{
	  position: absolute;
	  clip: rect(1px 1px 1px 1px);
	  clip: rect(1px, 1px, 1px, 1px);
	  padding: 0;
	  border: 0;
	  height: 1px;
	  width: 1px;
	  overflow: hidden;
	}
</style>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://ops.m114.org/post/deploy-ceph-using-china-mirror/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://ops.m114.org/post/deploy-ceph-using-china-mirror/">使用国内源部署Ceph</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://ops.m114.org/post/MySQL-Unable-to-lock-ibdata1-error-11-fix/">MySQL Unable to lock ibdata1 error 11 fix</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://ops.m114.org/post/MySQL-Unable-to-lock-ibdata1-error-11-fix/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>


  
  
  
  
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'vinsoncou';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


  

</div>

</div>
</div>
<script src="https://ops.m114.org/js/ui.js"></script>
<script src="https://ops.m114.org/js/menus.js"></script>










</body>
</html>

